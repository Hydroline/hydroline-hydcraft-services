# 流程引擎与高复用能力

## 基本理念
- 流程系统应定义为可复用的核心模块，具备通用的状态迁移、节点定义、角色校验与日志记录能力。
- 任何需要“审批”、“审核”、“多阶段处理”的业务都可复用，如工商审核、土地审批、内容审核等。

## 核心构件
1. **流程模板（WorkflowDefinition）**
   - 拥有唯一 `code`（如 `company-registration`）、名称、描述。
   - 定义节点链：每个节点配置 `id`、名称、角色（可指定多个）、动作集（通过、驳回、补件）、超时时间、是否可并行。
2. **流程实例（WorkflowInstance）**
   - 关联业务实体（`companyId` 或其他 `targetId` + `targetType`）。
   - 记录当前节点、历史节点、上下文数据（如提交材料地址）。
3. **节点动作（WorkflowAction）**
   - 管理员在节点上执行的行为，包含动作类型、操作人、备注、附件、执行时间。
   - 动作触发状态迁移及通知；也支持“转交”、“加签”等扩展动作。
4. **状态快照（WorkflowStateSnapshot）**
   - 用于查询某个业务在流程中的完整轨迹，便于前端展示与回溯。

## 可复用特性
- **流程模板配置**支持通过数据库或文件动态加载，便于运营调整。
- **权限策略抽象**：节点可指定多个角色/岗位，审批接口仅允许拥有匹配权限的管理员操作。
- **流程上下文**：支持挂载任意业务字段（如公司类型、证件号），并在流程中共享，便于规则判断。
- **通知钩子**：定义在某些节点动作后自动触发通知（邮件/站内信），对外发送流程进展提示。

## 扩展性建议
- 为未来业务加入「流程事件」监听机制，可在节点进入/离开时调用外部逻辑（如生成合同、调用第三方系统）。
- 与现有任务/待办模块对接，保证后台人员可在统一界面处理不同业务的审批事项。
- 提供「模拟执行」能力，帮助产品快速验证新流程定义，再推广到正式环境。
