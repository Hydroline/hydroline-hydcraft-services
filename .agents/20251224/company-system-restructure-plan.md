# 2025-12-24 工商系统前后端结构调整规划（todolist + requirements）

## 背景与目标

- 现状：工商系统结构与界面偏复杂，导航与页面层级不清晰；列表与对话框样式不统一。
- 目标：对齐 transportation 模块的导航结构与视觉样式，建立统一 RouterView；用户侧拆分“导览 / 仪表盘 / 工商数据库”；后台拆分“公司管理 / 公司申请”，并完善审批、审计、权限等流程。
- 约束：不使用模拟数据；所有文案中文；涉及新流程先做 MVP 验证，再推广。

## Requirements

- [x] R1：工商系统导航结构对齐 `transportation`，并复用其顶部 tab 样式（1:1 CSS）改为“导览 / 仪表盘 / 工商数据库”。
- [x] R2：`/company` 保留为“导览”页面；新增统一布局 RouterView 承载三个子页面。
- [x] R3：仪表盘细分为“名下公司 / 入职公司”，先给概览卡片 + 前 5 数据；进入详情后才能操作。
- [x] R4：所有表格与分页样式 1:1 对齐 `rank` 模块；操作区单独列，按钮对齐。
- [x] R5：名下公司支持：提交注册申请、查看注册详情、流程状态、入职申请/员工管理对话框、公司管理入口、logo 上传裁剪。
- [x] R6：入职公司支持：全量公司列表、类型筛选、入职申请对话框（岗位可选）、等待审核或自动通过。
- [x] R7：老板可设置公司“入职方式”（自动通过/审核），可分配岗位与权限；岗位权限为公司内部小型权限节点，不与系统 RBAC 混用。
- [x] R8：后台公司管理仅展示公司信息（logo/岗位/成员/权限/资料），流程审批移至公司申请页面；流程状态仅信息展示。
- [x] R9：后台审批仅提供“通过/不通过/打回修改”等动作；审批通过即入库并结束流程。
- [x] R10：所有流程/状态/下拉项使用中文映射；SelectMenu 映射关系正确。
- [x] R11：管理员编辑公司信息需要审计记录，展示在公司详情内；公司所有者可看到被修改内容与原因（记录谁改、何时改、原因）。
- [x] R12：后端仅需 `pnpm build` 测试；移除 Playwright 验证要求。

## TodoList

### A. 路由与布局（对齐 transportation）

- [x] 新建 `frontend/src/views/user/Company/CompanyLayout.vue`，复刻 `TransportationLayout.vue` 的 tab 与容器样式。
- [x] 设定 tabs：导览(`company.overview`)、仪表盘(`company.dashboard`)、工商数据库(`company.database`)。
- [x] 调整路由：`/company` 指向 Layout，并增加子路由；保留导览为默认入口。
- [x] 确保 user/Company 子模块统一 RouterView；现有页面迁入子路由。

### B. 用户侧页面 IA（导览/仪表盘/数据库）

- [x] 导览：复用现有 `CompanyOverviewView.vue`，适配新的 layout 结构。
- [x] 仪表盘入口：改为“概览 + 前 5 预览”，提供“查看详情”进入名下/入职页。
- [x] 工商数据库：新建页面并套用 rank 表格 + 筛选布局。

### C. 仪表盘 - 名下公司（表格 + 操作）

- [x] 视图拆分：新增 `CompanyOwnedListView.vue`（或嵌入仪表盘子路由）。
- [x] 顶部按钮：右上角“提交注册申请”。
- [x] 表格样式：完全复刻 `rank` 表格/分页结构（含表头、滚动、页码输入）。
- [x] 列字段：公司名/公司所属人/行业等核心字段（字段自由发挥，保留基础信息）。
- [x] 操作列：
  - [x] 注册详情（页面内信息卡展示）。
  - [x] 入职申请 dialog（每行按钮）。
  - [x] 员工管理 dialog（每行按钮）。
  - [x] 公司管理入口改为 dialog（参考后台 `UserDetail.vue` 布局）。
- [x] 公司管理 dialog：对齐栅格，含资料编辑、logo 上传裁剪、岗位与权限配置入口。
- [x] “返回”按钮：所有名下/入职子页左上角为“返回仪表盘”。

### D. 仪表盘 - 入职公司（列表 + 申请）

- [x] 视图拆分：新增 `CompanyJoinListView.vue`。
- [x] 列表展示全部公司，支持类型/行业筛选。
- [x] 申请 dialog：岗位为可选项；支持“仅填写期望岗位”或“不填写”。
- [x] 依据入职方式：自动通过或等待审核。

### E. 岗位、权限与入职方式（后端）

- [x] 明确模型：
  - [x] 公司入职方式字段（AUTO / REVIEW）。
  - [x] 岗位权限节点粗略分组（可看后台、可管人 HR、可共同修改公司信息），支持叠加；法人最大。
- [x] 新增/调整 API：
  - [x] 读取/更新公司入职方式与岗位权限。
  - [x] 入职申请创建与审核流转。
- [x] 加入流程：支持自动通过时立即入职，审核模式写入待审记录。

### F. 后台公司管理与审批拆分

- [x] `CompanyRegistryView.vue`：移除表格下方的“后台编辑字段/流程动作”，改为操作区两个独立 dialog。
- [x] 公司管理 dialog：展示公司资料、logo、岗位、员工、权限与审计日志。
- [x] 审核流程 dialog：仅显示可执行动作 + 备注；流程信息用 info 框展示。
- [x] `CompanyApplicationsView.vue`：承接审批流程（通过/驳回/打回修改）。
- [x] 审批完成后写入公司数据库并归档流程。

### G. 文案与 SelectMenu 映射

- [x] 统一状态/流程中文标签（CompanyStatus、CompanyApplicationStatus）。
- [x] 修正 USelectMenu 的 value/label 映射一致性。
- [x] 所有 dialog 表单对齐布局统一（label + input 栅格）。

### H. 前端 Store 与类型调整

- [x] `frontend/src/stores/user/companies`：补充仪表盘拆分数据与数据库列表接口。
- [x] `frontend/src/stores/admin/companies`：新增公司详情、审计日志、岗位/权限配置读取。
- [x] `frontend/src/stores/admin/companyApplications`：加入审批操作接口。

### I. 验证清单（不使用 Playwright）

- [x] 用户端：打开工商系统 tabs，进入导览/仪表盘/数据库。
- [x] 仪表盘：查看前 5 列表 -> 进入名下/入职详情，确认表格与分页样式。
- [x] 入职申请：提交岗位申请（含空岗位），验证等待/自动通过逻辑。
- [x] 管理员端：公司管理/公司申请页面操作流程与中文文案（结构调整完成）。

## 已确认信息

- [x] 表格字段清单：自由发挥，至少包含公司名/所属人/行业等。
- [x] 入职方式枚举：自动通过 / 需审核。
- [x] 权限节点：可看公司后台 / 可管人(HR) / 可共同修改公司信息，支持叠加；法人最大。
- [x] 公司管理入口：使用 dialog，参考后台 `UserDetail.vue` 布局。
- [x] 审计日志：记录“谁改/何时/原因”，不记录改了哪些字段。
